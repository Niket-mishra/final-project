<div class="officer-container container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
    <h3 class="fw-bold text-gradient">ðŸ‘¥ Loan Officers</h3>
    <a class="btn btn-primary d-flex align-items-center gap-2" [routerLink]="['create']">
      <i class="bi bi-person-plus"></i> Add Officer
    </a>
  </div>

  <!-- Search, Filter, Page size, Toggle view -->
  <div class="search-filter-bar d-flex flex-wrap gap-3 align-items-center p-3 rounded shadow-sm mb-4">
    <input type="text" class="form-control" placeholder="Search officers..." [(ngModel)]="searchTerm" (input)="applyFilters()" />
    <select class="form-select" [(ngModel)]="statusFilter" (change)="applyFilters()">
      <option value="">All</option>
      <option value="active">Active</option>
      <option value="inactive">Inactive</option>
    </select>
    <select class="form-select" [(ngModel)]="pageSize" (change)="applyFilters()">
      <option [value]="2" selected>2</option>
      <option [value]="4">4</option>
      <option [value]="10">10</option>
    </select>
    <div class="btn-group ms-auto">
      <button class="btn btn-light" [class.active]="viewMode==='grid'" (click)="viewMode='grid'"><i class="bi bi-grid-3x3-gap"></i></button>
      <button class="btn btn-light" [class.active]="viewMode==='list'" (click)="viewMode='list'"><i class="bi bi-list"></i></button>
    </div>
  </div>

  <!-- Loader -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary"></div>
    <p class="mt-2 text-muted">Loading officers...</p>
  </div>

  <!-- Officers Table/Grid -->
  <div *ngIf="!isLoading && filteredOfficers.length === 0" class="text-center text-muted">
    No officers found.
  </div>

  <div *ngIf="!isLoading && filteredOfficers.length > 0">
    <!-- Grid View -->
    <div class="row g-4" *ngIf="viewMode==='grid'">
      <div class="col-md-6 col-lg-4" *ngFor="let officer of paginatedOfficers; trackBy: trackByOfficerId">
        <div class="card officer-card h-100 glass-card shadow-lg border-0">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h5 class="fw-bold mb-0">{{ officer.user.username }}</h5>
              <span class="badge px-3 py-2" [ngClass]="officer.isActive ? 'bg-success' : 'bg-secondary'">
                {{ officer.isActive ? 'Active' : 'Inactive' }}
              </span>
            </div>
            <p class="text-muted small">{{ officer.designation }} â€” {{ officer.city }}</p>
            <p><i class="bi bi-briefcase-fill text-info"></i> <strong> Specialization:</strong> {{ officer.specialization }}</p>
            <p><i class="bi bi-bar-chart-fill text-success"></i> <strong> Workload:</strong> {{ officer.currentWorkload }}/{{ officer.maxLoansAssigned }}</p>
            <p><i class="bi bi-star-fill text-warning"></i> <strong> Performance:</strong> {{ officer.performanceRating ?? 'N/A' }}</p>

            <!-- Edit/Delete -->
            <div class="d-flex gap-2 mt-3">
              <a class="btn btn-sm btn-outline-primary" [routerLink]="[officer.officerId,'edit']">
                <i class="bi bi-pencil-square"></i> Edit
              </a>
              <button class="btn btn-sm btn-outline-danger" (click)="confirmDelete(officer.officerId)">
                <i class="bi bi-trash"></i> Delete
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- List View -->
     @if(viewMode==='list'){
    <div class="table-responsive">
      <table class="table table-hover align-middle shadow-sm rounded">
        <thead class="table-light">
          <tr>
            <th>Username</th><th>Designation</th><th>City</th><th>Specialization</th><th>Workload</th><th>Performance</th><th>Status</th><th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let officer of paginatedOfficers; trackBy: trackByOfficerId">
            <td><strong>{{ officer.user.username }}</strong></td>
            <td>{{ officer.designation }}</td>
            <td>{{ officer.city }}</td>
            <td>{{ officer.specialization }}</td>
            <td>{{ officer.currentWorkload }}/{{ officer.maxLoansAssigned }}</td>
            <td>{{ officer.performanceRating ?? 'N/A' }}</td>
            <td><span class="badge" [ngClass]="officer.isActive ? 'bg-success' : 'bg-secondary'">{{ officer.isActive ? 'Active' : 'Inactive' }}</span></td>
            <td>
              <a class="btn btn-sm btn-outline-primary me-2" [routerLink]="[officer.officerId,'edit']"><i class="bi bi-pencil-square"></i></a>
              <button class="btn btn-sm btn-outline-danger" (click)="confirmDelete(officer.officerId)"><i class="bi bi-trash"></i></button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    }

    <!-- Pagination -->
    <nav class="mt-4">
      <ul class="pagination justify-content-center gap-2">
        <li class="page-item" [class.disabled]="currentPage===1">
          <button class="page-link rounded-pill" (click)="changePage(currentPage-1)"><i class="bi bi-chevron-left"></i></button>
        </li>
        <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i=index" [class.active]="currentPage===i+1">
          <button class="page-link rounded-pill fw-bold" (click)="changePage(i+1)">{{ i+1 }}</button>
        </li>
        <li class="page-item" [class.disabled]="currentPage===totalPages">
          <button class="page-link rounded-pill" (click)="changePage(currentPage+1)"><i class="bi bi-chevron-right"></i></button>
        </li>
      </ul>
    </nav>
  </div>
</div>


<!-- ðŸ”¹ Custom Confirmation Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-body text-center">
        <p class="mb-3">{{ confirmMessage }}</p>
        <div class="d-flex justify-content-center gap-2">
          <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-danger btn-sm" (click)="confirmAction()">Yes</button>
        </div>
      </div>
    </div>
  </div>
</div>
