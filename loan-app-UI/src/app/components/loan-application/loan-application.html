<div class="container py-4">
  <h2 class="mb-4">Loan Applications</h2>

  @if (error) {
    <div class="alert alert-danger">{{ error }}</div>
  }

  @if (success) {
    <div class="alert alert-success">{{ success }}</div>
  }

  <div class="row g-3">
    @for (app of applications; track app.applicationId) {
      <div class="col-md-6">
        <div class="card shadow-sm border-0">
          <div class="card-body">
            <h5 class="card-title">Application #{{ app.applicationId }}</h5>
            <p><strong>Customer:</strong> {{ app.customer?.firstName }} {{ app.customer?.lastName ?? '' }}</p>
            <p><strong>Scheme:</strong> {{ app.loanScheme?.schemeName ?? 'N/A' }}</p>
            <p><strong>Amount:</strong> {{ formatCurrency(app.requestedAmount) }}</p>
            <p>
              <strong>Status:</strong>
              <span class="badge bg-{{ getStatusColor(app.status) }}">{{ app.status }}</span>
            </p>

            <div class="mt-3">
              <button class="btn btn-sm btn-success me-2" (click)="updateStatus(app, Status.Approved)">Approve</button>
              <button class="btn btn-sm btn-danger me-2" (click)="updateStatus(app, Status.Rejected)">Reject</button>
              <button class="btn btn-sm btn-secondary me-2" (click)="updateStatus(app, Status.Pending)">Reset</button>
              <button class="btn btn-sm btn-outline-primary" (click)="openEditModal(app)">Update</button>
            </div>
          </div>
        </div>
      </div>
    }
  </div>

  <!-- 📝 Edit Modal -->
  <app-modal-wrapper [title]="'Update Application'" [show]="showEditModal" (close)="cancelEdit()">
    @if (editApplication) {
      <div class="mb-3">
        <label class="form-label">Requested Amount</label>
        <input type="number" class="form-control mb-2" [(ngModel)]="editApplication.requestedAmount" />

        <label class="form-label">Purpose of Loan</label>
        <input type="text" class="form-control mb-2" [(ngModel)]="editApplication.purposeOfLoan" />

        <label class="form-label">Employment Details</label>
        <input type="text" class="form-control mb-2" [(ngModel)]="editApplication.employmentDetails" />

        <label class="form-label">Submitted Documents</label>
        <textarea class="form-control mb-2" [(ngModel)]="editApplication.submittedDocuments"></textarea>
      </div>

      <div class="d-flex gap-2">
        <button class="btn btn-primary btn-sm" (click)="submitUpdate()">Save Changes</button>
        <button class="btn btn-secondary btn-sm" (click)="cancelEdit()">Cancel</button>
      </div>

      @if (updateError) {
        <div class="text-danger mt-2">{{ updateError }}</div>
      }

      @if (updateSuccess) {
        <div class="text-success mt-2">{{ updateSuccess }}</div>
      }
    }
  </app-modal-wrapper>
</div>