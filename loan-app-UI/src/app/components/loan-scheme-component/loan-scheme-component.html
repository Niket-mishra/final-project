<div class="container py-4">
  <h2 class="mb-4">Loan Schemes</h2>

  <!-- 📊 Stats Card -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body d-flex justify-content-between">
      <div><strong>Total:</strong> {{ loanSchemes.length }}</div>
      <div><strong>Active:</strong> {{ getActiveCount() }}</div>
      <div><strong>Avg Interest:</strong> {{ getAverageInterest() }}%</div>
    </div>
  </div>

  <!-- 🧠 Create Form -->
  <button class="btn btn-outline-primary mb-3" (click)="toggleCreateForm()">+ Create New Scheme</button>
  @if (showCreateForm) {
    <div class="card mb-4">
      <div class="card-body">
        <h5>Create Loan Scheme</h5>
        <input [(ngModel)]="newScheme.schemeName" class="form-control mb-2" placeholder="Scheme Name" />
        <input [(ngModel)]="newScheme.interestRate" class="form-control mb-2" type="number" placeholder="Interest Rate (%)" />
        <input [(ngModel)]="newScheme.maxAmount" class="form-control mb-2" type="number" placeholder="Max Amount" />
        <input [(ngModel)]="newScheme.minAmount" class="form-control mb-2" type="number" placeholder="Min Amount" />
        <input [(ngModel)]="newScheme.tenureMonths" class="form-control mb-2" type="number" placeholder="Tenure (months)" />
        <textarea [(ngModel)]="newScheme.eligibilityCriteria" class="form-control mb-2" placeholder="Eligibility Criteria"></textarea>
        <button class="btn btn-success me-2" (click)="createScheme()" [disabled]="isCreating">Create</button>
        <button class="btn btn-secondary" (click)="toggleCreateForm()">Cancel</button>
        @if (error) { <div class="text-danger mt-2">{{ error }}</div> }
        @if (successMessage) { <div class="text-success mt-2">{{ successMessage }}</div> }
      </div>
    </div>
  }

  <!-- 🧩 Scheme List -->
  <div class="row g-3">
    @for (scheme of loanSchemes; track scheme.schemeId) {
      <div class="col-md-6">
        <div class="card shadow-sm border-0">
          <div class="card-body">
            <h5 class="card-title">{{ scheme.schemeName }}</h5>
            <p class="mb-1">Interest: {{ formatInterestRate(scheme.interestRate) }}</p>
            <p class="mb-1">Amount: {{ formatCurrency(scheme.minAmount) }} – {{ formatCurrency(scheme.maxAmount) }}</p>
            <p class="mb-1">Tenure: {{ formatTenure(scheme.tenureMonths) }}</p>
            <p class="mb-1">Status: <span class="badge bg-{{ scheme.isActive ? 'success' : 'secondary' }}">{{ scheme.isActive ? 'Active' : 'Inactive' }}</span></p>

            <button class="btn btn-sm btn-outline-primary me-2" (click)="openEditModal(scheme)">Edit</button>
            <button class="btn btn-sm btn-outline-danger me-2" (click)="openDeleteModal(scheme.schemeId)">Delete</button>
            <button class="btn btn-sm btn-outline-warning" (click)="scheme.isActive = !scheme.isActive">Toggle Status</button>
          </div>
        </div>
      </div>
    }
  </div>

  <!-- 📝 Edit Modal -->
  <app-modal-wrapper [title]="'Edit Scheme'" [show]="showEditModal" (close)="cancelEdit()">
    <input [(ngModel)]="editScheme.schemeName" class="form-control mb-2" placeholder="Scheme Name" />
    <input [(ngModel)]="editScheme.interestRate" class="form-control mb-2" type="number" placeholder="Interest Rate (%)" />
    <input [(ngModel)]="editScheme.maxAmount" class="form-control mb-2" type="number" placeholder="Max Amount" />
    <input [(ngModel)]="editScheme.minAmount" class="form-control mb-2" type="number" placeholder="Min Amount" />
    <input [(ngModel)]="editScheme.tenureMonths" class="form-control mb-2" type="number" placeholder="Tenure (months)" />
    <textarea [(ngModel)]="editScheme.eligibilityCriteria" class="form-control mb-2" placeholder="Eligibility Criteria"></textarea>
    <button class="btn btn-primary me-2" (click)="updateScheme()">Update</button>
    <button class="btn btn-secondary" (click)="cancelEdit()">Cancel</button>
    @if (error) { <div class="text-danger mt-2">{{ error }}</div> }
    @if (successMessage) { <div class="text-success mt-2">{{ successMessage }}</div> }
  </app-modal-wrapper>

  <!-- ❌ Delete Modal -->
  <app-modal-wrapper [title]="'Confirm Delete'" [show]="showDeleteModal" (close)="cancelDelete()">
    <p>Are you sure you want to delete this loan scheme?</p>
    <button class="btn btn-danger me-2" (click)="deleteScheme()" [disabled]="isDeleting">Yes, Delete</button>
    <button class="btn btn-secondary" (click)="cancelDelete()">Cancel</button>
    @if (deleteError) { <div class="text-danger mt-2">{{ deleteError }}</div> }
    @if (deleteSuccessMessage) { <div class="text-success mt-2">{{ deleteSuccessMessage }}</div> }
  </app-modal-wrapper>
</div>